(function(h){var k=function(g){return"http://query.yahooapis.com/v1/public/yql?q=__QUERY__&env=store://datatables.org/alltableswithkeys&format=json".replace("__QUERY__",encodeURIComponent(g))};h.fn.lifestream=function(g){var i=this,e=jQuery.extend({classname:"lifestream",limit:10},g),b={count:e.list.length,items:[]},a=jQuery.extend(true,{},e),d=function(c){h.merge(b.items,c);b.items.sort(function(l,m){return l.date>m.date?-1:l.date===m.date?0:1});c=h('<ul class="'+e.classname+'"/>');for(var f=b.items.length<
e.limit?b.items.length:e.limit,j=0;j<f;j++)b.items[j].html&&c.append('<li class="'+e.classname+"-"+b.items[j].service+'">'+b.items[j].html+"</li>");i.html(c)};(function(){var c=0,f=e.list.length;for(delete a.list;c<f;c++){var j=e.list[c];if(h.fn.lifestream.feeds[j.service]&&h.isFunction(h.fn.lifestream.feeds[j.service])&&j.user){j._settings=a;h.fn.lifestream.feeds[j.service](j,d)}}})()};h.fn.lifestream.linkify=function(){var g=RegExp("(?:\\b[a-z\\d.-]+://[^<>\\s]+|\\b(?:(?:(?:[^\\s!@#$%^&*()_=+[\\]{}\\\\|;:'\",.<>/?]+)\\.)+(?:ac|ad|aero|ae|af|ag|ai|al|am|an|ao|aq|arpa|ar|asia|as|at|au|aw|ax|az|ba|bb|bd|be|bf|bg|bh|biz|bi|bj|bm|bn|bo|br|bs|bt|bv|bw|by|bz|cat|ca|cc|cd|cf|cg|ch|ci|ck|cl|cm|cn|coop|com|co|cr|cu|cv|cx|cy|cz|de|dj|dk|dm|do|dz|ec|edu|ee|eg|er|es|et|eu|fi|fj|fk|fm|fo|fr|ga|gb|gd|ge|gf|gg|gh|gi|gl|gm|gn|gov|gp|gq|gr|gs|gt|gu|gw|gy|hk|hm|hn|hr|ht|hu|id|ie|il|im|info|int|in|io|iq|ir|is|it|je|jm|jobs|jo|jp|ke|kg|kh|ki|km|kn|kp|kr|kw|ky|kz|la|lb|lc|li|lk|lr|ls|lt|lu|lv|ly|ma|mc|md|me|mg|mh|mil|mk|ml|mm|mn|mobi|mo|mp|mq|mr|ms|mt|museum|mu|mv|mw|mx|my|mz|name|na|nc|net|ne|nf|ng|ni|nl|no|np|nr|nu|nz|om|org|pa|pe|pf|pg|ph|pk|pl|pm|pn|pro|pr|ps|pt|pw|py|qa|re|ro|rs|ru|rw|sa|sb|sc|sd|se|sg|sh|si|sj|sk|sl|sm|sn|so|sr|st|su|sv|sy|sz|tc|td|tel|tf|tg|th|tj|tk|tl|tm|tn|to|tp|travel|tr|tt|tv|tw|tz|ua|ug|uk|um|us|uy|uz|va|vc|ve|vg|vi|vn|vu|wf|ws|xn--0zwm56d|xn--11b5bs3a9aj6g|xn--80akhbyknj4f|xn--9t4b11yi5a|xn--deba0ad|xn--g6w251d|xn--hgbk6aj7f53bba|xn--hlcj6aya9esc7a|xn--jxalpdlp|xn--kgbechtv|xn--zckzah|ye|yt|yu|za|zm|zw)|(?:(?:[0-9]|[1-9]\\d|1\\d{2}|2[0-4]\\d|25[0-5])\\.){3}(?:[0-9]|[1-9]\\d|1\\d{2}|2[0-4]\\d|25[0-5]))(?:[;/][^#?<>\\s]*)?(?:\\?[^#<>\\s]*)?(?:#[^<>\\s]*)?(?!\\w)|(?:mailto:)?[a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\\.[a-z0-9!#$%&'*+/=?^_`{|}~-]+)*@(?:(?:(?:[^\\s!@#$%^&*()_=+[\\]{}\\\\|;:'\",.<>/?]+)\\.)+(?:ac|ad|aero|ae|af|ag|ai|al|am|an|ao|aq|arpa|ar|asia|as|at|au|aw|ax|az|ba|bb|bd|be|bf|bg|bh|biz|bi|bj|bm|bn|bo|br|bs|bt|bv|bw|by|bz|cat|ca|cc|cd|cf|cg|ch|ci|ck|cl|cm|cn|coop|com|co|cr|cu|cv|cx|cy|cz|de|dj|dk|dm|do|dz|ec|edu|ee|eg|er|es|et|eu|fi|fj|fk|fm|fo|fr|ga|gb|gd|ge|gf|gg|gh|gi|gl|gm|gn|gov|gp|gq|gr|gs|gt|gu|gw|gy|hk|hm|hn|hr|ht|hu|id|ie|il|im|info|int|in|io|iq|ir|is|it|je|jm|jobs|jo|jp|ke|kg|kh|ki|km|kn|kp|kr|kw|ky|kz|la|lb|lc|li|lk|lr|ls|lt|lu|lv|ly|ma|mc|md|me|mg|mh|mil|mk|ml|mm|mn|mobi|mo|mp|mq|mr|ms|mt|museum|mu|mv|mw|mx|my|mz|name|na|nc|net|ne|nf|ng|ni|nl|no|np|nr|nu|nz|om|org|pa|pe|pf|pg|ph|pk|pl|pm|pn|pro|pr|ps|pt|pw|py|qa|re|ro|rs|ru|rw|sa|sb|sc|sd|se|sg|sh|si|sj|sk|sl|sm|sn|so|sr|st|su|sv|sy|sz|tc|td|tel|tf|tg|th|tj|tk|tl|tm|tn|to|tp|travel|tr|tt|tv|tw|tz|ua|ug|uk|um|us|uy|uz|va|vc|ve|vg|vi|vn|vu|wf|ws|xn--0zwm56d|xn--11b5bs3a9aj6g|xn--80akhbyknj4f|xn--9t4b11yi5a|xn--deba0ad|xn--g6w251d|xn--hgbk6aj7f53bba|xn--hlcj6aya9esc7a|xn--jxalpdlp|xn--kgbechtv|xn--zckzah|ye|yt|yu|za|zm|zw)|(?:(?:[0-9]|[1-9]\\d|1\\d{2}|2[0-4]\\d|25[0-5])\\.){3}(?:[0-9]|[1-9]\\d|1\\d{2}|2[0-4]\\d|25[0-5]))(?:\\?[^#<>\\s]*)?(?:#[^<>\\s]*)?(?!\\w))",
"ig"),i=/^[a-z\d.-]+:\/\//i,e={"'":"`",">":"<",")":"(","]":"[","}":"{","\u00bb":"\u00ab","\u203a":"\u2039"},b={callback:function(a,d){return d?'<a href="'+d+'" title="'+d+'">'+a+"</a>":a},punct_regexp:/(?:[!?.,:;'"]|(?:&|&amp;)(?:lt|gt|quot|apos|raquo|laquo|rsaquo|lsaquo);)$/};return function(a,d){d=d||{};var c,f,j="",l=[],m,o,q,p,n;for(c in b)if(b.hasOwnProperty(c)&&d[c]===undefined)d[c]=b[c];for(;c=g.exec(a);){c=c[0];o=g.lastIndex;q=o-c.length;if(!/[\/:]/.test(a.charAt(q-1))){do{f=c;n=c.substr(-1);
if(p=e[n]){p=c.match(RegExp("\\"+p+"(?!$)","g"));n=c.match(RegExp("\\"+n,"g"));if((p?p.length:0)<(n?n.length:0)){c=c.substr(0,c.length-1);o--}}if(d.punct_regexp)c=c.replace(d.punct_regexp,function(r){o-=r.length;return""})}while(c.length&&c!==f);f=c;i.test(f)||(f=(f.indexOf("@")!==-1?!f.indexOf("mailto:")?"":"mailto:":!f.indexOf("irc.")?"irc://":!f.indexOf("ftp.")?"ftp://":"http://")+f);if(m!=q){l.push([a.slice(m,q)]);m=o}l.push([c,f])}}l.push([a.substr(m)]);for(c=0;c<l.length;c++)j+=d.callback.apply(window,
l[c]);return j||a}}();h.fn.lifestream.feeds=h.fn.lifestream.feeds||{};h.fn.lifestream.feeds.delicious=function(g,i){var e=function(b){var a="";a+='added bookmark <a href="'+b.u+'">'+b.d+"</a>";return a};h.ajax({url:"http://feeds.delicious.com/v2/json/"+g.user,dataType:"jsonp",success:function(b){var a=[],d=0,c;if(b&&b.length&&b.length>0)for(c=b.length;d<c;d++){var f=b[d];a.push({date:new Date(f.dt),service:g.service,html:e(f)})}i(a)}})};h.fn.lifestream.feeds.deviantart=function(g,i){h.ajax({url:k('select title,link,pubDate from rss where url="'+
g.user+'" | unique(field="title")'),dataType:"jsonp",success:function(e){var b=[];e=e.query.results.item;for(var a,d=0,c=e.length;d<c;++d){a=e[d];b.push({date:new Date(a.pubDate),service:g.service,html:'posted <a href="'+a.link+'">'+a.title+"</a>"})}i(b)}})};h.fn.lifestream.feeds.dribbble=function(g,i){h.ajax({url:"http://api.dribbble.com/players/"+g.user+"/shots",dataType:"jsonp",success:function(e){var b=[],a=0,d;if(e&&e.total)for(d=e.shots.length;a<d;a++){var c=e.shots[a];b.push({date:new Date(c.created_at),
service:g.service,html:'posted a shot <a href="'+c.url+'">'+c.title+"</a>"})}i(b)}})};h.fn.lifestream.feeds.flickr=function(g,i){h.ajax({url:"http://api.flickr.com/services/feeds/photos_public.gne?id="+g.user+"&lang=en-us&format=json",dataType:"jsonp",jsonp:"jsoncallback",success:function(e){var b=[],a=0,d;if(e&&e.items&&e.items.length>0)for(d=e.items.length;a<d;a++){var c=e.items[a];b.push({date:new Date(c.published),service:g.service,html:'posted a photo <a href="'+c.link+'">'+c.title+"</a>"})}i(b)}})};
h.fn.lifestream.feeds.foursquare=function(g,i){h.ajax({url:k('select * from rss where url="https://feeds.foursquare.com/history/'+g.user+'.rss"'),dataType:"jsonp",success:function(e){var b=[],a=0,d;if(e.query&&e.query.count&&e.query.count>0)for(d=e.query.count;a<d;a++){var c=e.query.results.item[a];b.push({date:new Date(c.pubDate),service:g.service,html:'checked in @ <a href="'+c.link+'">'+c.title+"</a>"})}i(b)}})};h.fn.lifestream.feeds.github=function(g,i){var e=function(a){return a.payload.repo||
a.repository.owner+"/"+a.repository.name},b=function(a){var d="",c,f,j;if(a.type==="PushEvent"){c="";f=e(a);if(a.payload&&a.payload.shas&&a.payload.shas.json&&a.payload.shas.json[2])c=a.payload.shas.json[2]+" by "+a.payload.shas.json[3];d+='<a href="'+a.url+'" title="'+c+'">pushed</a> to <a href="http://github.com/'+f+'">'+f+"</a>"}else if(a.type==="GistEvent"){c=a.payload.desc||"";d+=a.payload.action+'d <a href="'+a.payload.url+'" title ="'+c+'">'+a.payload.name+"</a>"}else if(a.type==="CommitCommentEvent"||
a.type==="IssueCommentEvent"){f=e(a);d+='<a href="'+a.url+'">commented</a> on <a href="http://github.com/'+f+'">'+f+"</a>"}else if(a.type==="PullRequestEvent"){f=a.payload.repo||a.repository.owner+"/"+a.repository.name;d+='<a href="'+a.url+'">'+a.payload.action+'</a> pull request on <a href="http://github.com/'+f+'">'+f+"</a>"}else if(a.type==="CreateEvent"&&(a.payload.ref_type==="tag"||a.payload.ref_type==="branch"||a.payload.object==="tag")){f=e(a);j=a.payload.ref_type||a.payload.object;c=a.payload.ref||
a.payload.object_name;d+="created "+j+' <a href="'+a.url+'">'+c+'</a> for <a href="http://github.com/'+f+'">'+f+"</a>"}else if(a.type==="CreateEvent"){c=a.payload.object_name==="null"?a.payload.name:a.payload.object_name;d+="created "+a.payload.object+' <a href="'+a.url+'">'+c+"</a>"}else if(a.type==="DeleteEvent")d+="deleted "+a.payload.ref_type+' <a href="http://github.com/'+a.repository.owner+"/"+a.repository.name+'">'+a.payload.ref+"</a>";return d};h.ajax({url:k('select json.repository.owner,json.repository.name,json.payload,json.type,json.url, json.created_at from json where url="http://github.com/'+
g.user+'.json"'),dataType:"jsonp",success:function(a){var d=[],c=0,f;if(a.query&&a.query.count&&a.query.count>0)for(f=a.query.count;c<f;c++){var j=a.query.results.json[c].json;d.push({date:new Date(j.created_at),service:g.service,html:b(j)})}i(d)}})};h.fn.lifestream.feeds.googlereader=function(g,i){h.ajax({url:k('select * from xml where url="www.google.com/reader/public/atom/user%2F'+g.user+'%2Fstate%2Fcom.google%2Fstarred"'),dataType:"jsonp",success:function(e){var b=[],a=0,d;if(e.query&&e.query.count&&
e.query.count>0){e=e.query.results.feed.entry;for(d=e.length;a<d;a++){var c=e[a];b.push({date:new Date(parseInt(c["crawl-timestamp-msec"],10)),service:g.service,html:'starred post <a href="'+c.link.href+'">'+c.title.content+"</a>"})}}i(b)}})};h.fn.lifestream.feeds.lastfm=function(g,i){var e=function(b){var a="";a+='loved <a href="'+b.url+'">'+b.name+'</a> by <a href="'+b.artist.url+'">'+b.artist.name+"</a>";return a};h.ajax({url:k('select * from xml where url="http://ws.audioscrobbler.com/2.0/user/'+
g.user+'/lovedtracks.xml"'),dataType:"jsonp",success:function(b){var a=[],d=0,c;if(b.query&&b.query.count&&b.query.count>0&&b.query.results.lovedtracks&&b.query.results.lovedtracks.track){b=b.query.results.lovedtracks.track;for(c=b.length;d<c;d++){var f=b[d];a.push({date:new Date(parseInt(f.date.uts*1E3,10)),service:g.service,html:e(f)})}}i(a)}})};h.fn.lifestream.feeds.reddit=function(g,i){var e=function(b){var a="",d="",c="http://www.reddit.com/r/"+b.data.subreddit,f=b.data.ups-b.data.downs;f=f>
0?"+"+f:f;if(b.kind==="t1"){d="http://www.reddit.com/r/"+b.data.subreddit+"/comments/"+b.data.link_id.substring(3)+"/u/"+b.data.name.substring(3)+"?context=3";a+='<a href="'+d+'">commented ('+f+")</a> "}else if(b.kind==="t3")a+='<a href="http://www.reddit.com'+b.data.permalink+'">created new thread ('+f+")</a> ";a+=' in <a href="'+c+'">/r/'+b.data.subreddit+"</a>";return a};h.ajax({url:"http://www.reddit.com/user/"+g.user+".json",dataType:"jsonp",jsonp:"jsonp",success:function(b){var a=[],d=0,c;if(b&&
b.data&&b.data.children&&b.data.children.length>0)for(c=b.data.children.length;d<c;d++){var f=b.data.children[d];a.push({date:new Date(f.data.created*1E3),service:g.service,html:e(f)})}i(a)}})};h.fn.lifestream.feeds.slideshare=function(g,i){h.ajax({url:k('select * from xml where url="http://www.slideshare.net/rss/user/'+g.user+'"'),dataType:"jsonp",success:function(e){var b=[],a=0,d,c;if(e.query&&e.query.count&&e.query.count>0){e=e.query.results.rss.channel.item;for(d=e.length;a<d;a++){c=e[a];b.push({date:new Date(c.pubDate),
service:g.service,html:'uploaded a presentation <a href="'+c.link+'">'+c.title+"</a>"})}}i(b)}})};h.fn.lifestream.feeds.stackoverflow=function(g,i){var e=function(b){var a="",d="",c="",f="",j="http://stackoverflow.com/users/"+g.user;if(b.timeline_type==="badge"){d=b.timeline_type+" "+b.action+": "+b.description;c=b.detail;f=j+"?tab=reputation"}else if(b.timeline_type==="revision"||b.timeline_type==="comment"||b.timeline_type==="accepted"||b.timeline_type==="askoranswered"){d=b.post_type+" "+b.action;
c=b.detail||b.description||"";f="http://stackoverflow.com/questions/"+b.post_id}a+='<a href="'+f+'" title="'+c+'">'+d+"</a> - "+c;return a};h.ajax({url:"http://api.stackoverflow.com/1.1/users/"+g.user+"/timeline?jsonp",dataType:"jsonp",jsonp:"jsonp",success:function(b){var a=[],d=0,c;if(b&&b.total&&b.total>0&&b.user_timelines)for(c=b.user_timelines.length;d<c;d++){var f=b.user_timelines[d];a.push({date:new Date(f.creation_date*1E3),service:g.service,html:e(f)})}i(a)}})};h.fn.lifestream.feeds.tumblr=
function(g,i){var e=function(b,a){return{date:new Date(a.date),service:b.service,html:"posted a "+a.type+' <a href="'+a.url+'">'+(a["regular-title"]||a["quote-text"]||a["conversation-title"]||a["photo-caption"]||a["video-caption"]||a["audio-caption"]||a["regular-body"]||a["link-text"]||a.type||"").replace(/\<.+?\>/gi," ")+"</a>"}};h.ajax({url:k('select * from tumblr.posts where username="'+g.user+'"'),dataType:"jsonp",success:function(b){var a=[],d=0,c,f;if(b.query&&b.query.count&&b.query.count>0)if(h.isArray(b.query.results.posts.post))for(c=
b.query.results.posts.post.length;d<c;d++){f=b.query.results.posts.post[d];a.push(e(g,f))}else h.isPlainObject(b.query.results.posts.post)&&a.push(e(g,b.query.results.posts.post));i(a)}})};h.fn.lifestream.feeds.twitter=function(g,i){var e=function(b){return h.fn.lifestream.linkify(b).replace(/ #([A-Za-z0-9\/\.]*)/g,function(a){return' <a target="_new" href="http://twitter.com/search?q='+a.replace(" #","%23")+'">'+a+"</a>"}).replace(/@[\w]+/g,function(a){return'<a href="http://www.twitter.com/'+a.replace("@",
"")+'">'+a+"</a>"})};h.ajax({url:k('select status.id, status.created_at, status.text from twitter.user.timeline where screen_name="'+g.user+'"'),dataType:"jsonp",success:function(b){var a=[],d=0,c;if(b.query&&b.query.count&&b.query.count>0)for(c=b.query.count;d<c;d++){var f=b.query.results.statuses[d].status;a.push({date:new Date(f.created_at),service:g.service,html:e(f.text)})}i(a)}})};h.fn.lifestream.feeds.vimeo=function(g,i){h.ajax({url:"http://vimeo.com/api/v2/"+g.user+"/videos.json",dataType:"jsonp",
crossDomain:true,success:function(e){var b=[],a=0,d,c;if(e)for(d=e.length;a<d;a++){c=e[a];b.push({date:new Date(c.upload_date),service:g.service,html:'published a video <a href="'+c.url+'" title="'+c.description.replace(/"/g,"'").replace(/\<.+?\>/gi,"")+'">'+c.title+"</a>"})}i(b)}})};h.fn.lifestream.feeds.youtube=function(g,i){h.ajax({url:"http://gdata.youtube.com/feeds/api/users/"+g.user+"/favorites?v=2&alt=jsonc",dataType:"jsonp",success:function(e){var b=[],a=0,d,c;if(e.data&&e.data.items)for(d=
e.data.items.length;a<d;a++){c=e.data.items[a];b.push({date:new Date(c.created),service:g.service,html:' favorited <a href="'+c.video.player["default"]+'" title="'+c.video.description+'">'+c.video.title+"</a>"})}i(b)}})}})(jQuery);
