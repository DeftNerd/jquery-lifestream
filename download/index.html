<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Custom Download Builder</title>
  <style type="text/css">
    #app {
      background-color: #aaaaaa;
    }
  </style>
  <script type="text/javascript" src="js/swfobject.js"></script> 
	<script type="text/javascript" src="js/downloadify.min.js"></script> 
</head>
<body>
  <div id="app">
    <h1>Custom Download Builder</h1>
    
    <div id="service-ui">
      <ul> <!-- This will be dynamically generated from services included in jlf src -->
        <li><img src="twitter-icon"><label for="twitter">Twitter</label><input type="checkbox"></li>
      </ul>
    </div> <!-- #service-ui -->
    
    <p>Services included: </p>
    <ul id="services-included"></ul>
    
    <textarea id="extracted-source" rows="20" cols="82"></textarea>
    
    <p id="downloadify"> 
      You must have Flash 10 installed to download this file.
		</p> 
    
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.6.1/jquery.js"></script>
    <script>!window.jQuery && document.write('<script src="http://code.jquery.com/jquery-1.6.1.min.js"><\/script>');</script>
    <script>
    // TODO: Check if we have all deps loading
    
    concatMinifiedScripts(
      ['delicious', 'deviantart', 'blogger', 'dailymotion', 'dribbble'], 
      {core: '../src/', feeds: '../src/feeds/'},
      function(out) { 
        $('#extracted-source').html(out);
        
        Downloadify.create('downloadify',{
          filename: function(){
            return 'jquery.lifestream.js';
          },
          data: function(){ 
            return out;
          },
          onComplete: function(){ alert('Your File Has Been Saved!'); },
          onCancel: function(){ alert('You have cancelled the saving of this file.'); },
          onError: function(){ alert('You must put something in the File Contents or there will be nothing to save!'); },
          transparent: false,
          swf: 'media/downloadify.swf',
          downloadImage: 'img/download.png',
          width: 100,
          height: 30,
          transparent: true,
          append: false
        });
      }
    );
    
    function concatMinifiedScripts(feeds, paths, success) {
      var 
        out = [],
        countdown = 1 + feeds.length,
        concat = function(scriptText) {
          out.push(scriptText);
          if (!--countdown)
            success(out.join(''));
        }
      ;
      $.getScript(paths['core'] + 'core.js', function(scriptText) {
        concat(scriptText);
        // The feeds scripts are not (necessarily) 
        // concatened in the same order as in the feeds array.
        // We don't need to preserve that order so we can
        // just fire all the script requests (potentially)
        // speeding up the process.
        $.each(feeds, function(i, f) {
          $.getScript(paths['feeds'] + f + '.js', function(scriptText) {
            concat(scriptText);
          });
        });
      });
    }
    </script>
  </div> <!-- #app -->
  
  
</body>
</html>